<!-- "script/apps/Aries/Creator/Game/Movie/MovieClipController.html" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
<pe:mcml>
<script refresh="false" type="text/npl" src="MovieClipController.lua"><![CDATA[
GameLogic = commonlib.gettable("MyCompany.Aries.Game.GameLogic")
MovieClipController = commonlib.gettable("MyCompany.Aries.Game.Movie.MovieClipController");
MovieClipController.OnInit();

function GetTitle()
    return format("%s", MovieClipController.GetTitle());
end

function IsActorSlotEmpty(slotNumber)
    local view = MovieClipController.GetActorInventoryView();
    if(view) then
        local itemStack = view:GetSlotItemStack(slotNumber)
        if(itemStack) then
            return true;
        end
    end
end

function IsSelectedActor(slotNumber)
    local view = MovieClipController.GetActorInventoryView();
    if(view) then
        local itemStack = view:GetSlotItemStack(slotNumber)
        if(itemStack) then
            return MovieClipController.GetItemStack() == itemStack;
        end
    end
    return false;
end

function DS_Actor_Inventory(index)
	local view = MovieClipController.GetActorInventoryView();
	if(view) then
        return view:GetSlotDS(index);
	else
		if(index == nil) then
			return 0;
        end
	end
end

function OnClickEmptySlot(mcmlNode)
    local item = mcmlNode:GetPreValue("this", true);
    if(item and item.slotNumber) then
        MovieClipController.OnClickEmptySlot(item.slotNumber);
    end
end

]]></script>

<pe:if condition='<%=not MovieClipController.IsPlayingMode()%>'>
    <pe:container alignment="_rb" style="margin-left:;margin-top:;texpack:addr_by_id(movieedit_PC->13.png);">

        <input type="button" name="close" style="margin-left:330px;margin-top:16px;texpack:addr_by_id(movieedit_PC->22.png);" onclick="MovieClipController.OnClose()" />
    
        <input type="button" name="AddNPC"  tooltip='<%=TL"添加演员"%>' style="margin-left:10px;margin-top:20px;texpack:addr_by_id(movieedit_PC->07.png);" onclick="MovieClipController.OnClickAddNPC()"/>
        <input type="button" name="godview" tooltip='<%=TL"控制主角"%>' style="margin-left:20px;margin-top:28px;texpack:addr_by_id(movieedit_PC->12.png);" onclick="MovieClipController.OnClickGodMode()"/>

        <pe:gridview name="InventoryItems" style="margin-left:7px;margin-top:10px;height:200px;" VerticalScrollBarStep="64" DataSource="<%=DS_Actor_Inventory%>" CellPadding="0" DefaultNodeHeight="67" ItemsPerLine="5" AllowPaging="false" RememberScrollPos="true" RememberLastPage="true" pagesize="256">
            <Columns>
            <div style="margin-left:3px">
                <pe:if condition='<%=IsSelectedActor(Eval("slotNumber"))%>'>
                    <div style="texpack:addr_by_id(movieedit_PC->09.png);width:64px;height:64px;">
                        <pe:mc_slot switchTouchButton="true" ContainerView='<%=MovieClipController.GetActorInventoryView()%>' bagpos ='<%=Eval("slotNumber")%>' style="margin:1px;width:64px;height:64px;"></pe:mc_slot>
                    </div>
                </pe:if>
                <pe:if condition='<%=not IsSelectedActor(Eval("slotNumber"))%>'>
                    <div style="texpack:addr_by_id(movieedit_PC->08.png);width:64px;height:64px;">
                        <pe:mc_slot switchTouchButton="true" class="mc_slot" onclick_empty="OnClickEmptySlot" ContainerView='<%=MovieClipController.GetActorInventoryView()%>' bagpos ='<%=Eval("slotNumber")%>' style="margin:1px;width:60px;height:64px;"></pe:mc_slot>
                    </div>
                </pe:if>
            </div>
            </Columns>
        </pe:gridview>
        
        <input type="button" name="addkeyframe" tooltip='<%=L"左键:加入关键帧\n右键:锁定/解锁对象"%>' style="margin-left:15px;margin-top:15px;texpack:addr_by_id(movieedit_PC->44.png);" onclick="MovieClipController.OnClickAddKeyFrameButton()"/>
        <pe:if condition='<%=not MovieClipController.isMovieRecording()%>'>
        <input type="button" name="record" tooltip='<%=L"左键:录制/暂停\nshift+左键:清空所有录制的动作"%>' style="margin-left:15px;margin-top:15px;texpack:addr_by_id(movieedit_PC->45.png);" onclick="MovieClipController.OnRecord()"/>
        </pe:if>
        <!-- recording -->
        <pe:if condition='<%=MovieClipController.isMovieRecording()%>'>
        <img style="margin-left:15px;margin-top:7px;texpack:addr_by_id(movieedit_PC->03.png);"/>
        <input type="button" name="record" tooltip='<%=L"左键:录制/暂停\nshift+左键:清空所有录制的动作"%>' style="margin-left:-55px;margin-top:15px;texpack:addr_by_id(movieedit_PC->45.png);" onclick="MovieClipController.OnRecord()"/>
        </pe:if>

        <input type="button" name="settings" tooltip='<%=L"设置或修改当前对象"%>' style="margin-left:15px;margin-top:13px;texpack:addr_by_id(movieedit_PC->46.png);" onclick="MovieClipController.OnSettings()"/>
        

        <div style="margin-top:20px;">
            <input type="button" name="to_begin" tooltip='<%=TL"到开始"%>' style="margin-left:36px;texpack:addr_by_id(movieedit_PC->04.png);" onclick="MovieClipController.OnGotoBeginFrame()"/>
            <pe:if condition='<%=not MovieClipController.isMoviePlaying()%>'>
            <input type="button" name="play" tooltip='<%=TL"播放"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->06.png);" onclick="MovieClipController.OnPlay()"/>
            </pe:if>
            <pe:if condition='<%=MovieClipController.isMoviePlaying()%>'>
            <input type="button" name="play" tooltip='<%=TL"暂停"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->48.png);" onclick="MovieClipController.OnPlay()"/>
            </pe:if>
            <input type="button" name="to_last" tooltip='<%=TL"到最后"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->05.png);" onclick="MovieClipController.OnGotoEndFrame()"/>

        </div>

        <input type="button" name="text" enabled="false" style="margin-left:240px;margin-top:-30px;width:70px;background:;font-size:32px;color:#99ff99;font-weight:bold;"/>
        
    </pe:container>
</pe:if>
    
    
<pe:if condition='<%=MovieClipController.IsPlayingMode()%>'>
    <pe:container alignment="_rb" style="margin-left:;margin-top:;texpack:addr_by_id(movieedit_PC->47.png);">
        <input type="button" name="close" style="margin-left:315px;margin-top:16px;texpack:addr_by_id(movieedit_PC->22.png);" onclick="MovieClipController.OnClose()" />
       
        <div style="margin-top:40px;">
            <input type="button" name="to_begin" tooltip='<%=TL"到开始"%>' style="margin-left:36px;texpack:addr_by_id(movieedit_PC->04.png);" onclick="MovieClipController.OnGotoBeginFrame()"/>
            <pe:if condition='<%=not MovieClipController.isMoviePlaying()%>'>
            <input type="button" name="play" tooltip='<%=TL"播放"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->06.png);" onclick="MovieClipController.OnPlay()"/>
            </pe:if>
            <pe:if condition='<%=MovieClipController.isMoviePlaying()%>'>
            <input type="button" name="pause" tooltip='<%=TL"暂停"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->48.png);" onclick="MovieClipController.OnPlay()"/>
            </pe:if>
            <input type="button" name="to_last" tooltip='<%=TL"到最后"%>' style="margin-left:25px;texpack:addr_by_id(movieedit_PC->05.png);" onclick="MovieClipController.OnGotoEndFrame()"/>

        </div>
        
        <input type="button" name="text" enabled="false" style="margin-left:20px;margin-top:0px;width:70px;background:;font-size:32px;color:#99ff99;font-weight:bold;"/>
        
    </pe:container>
</pe:if>


</pe:mcml>
</body>
</html>
